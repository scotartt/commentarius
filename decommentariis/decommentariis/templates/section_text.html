{% extends 'commentarius_base.html' %}
{% load shorter_cts %}
{% block title %}
decommentariis - {{ object.entry.author }} -
{{ object.cts_urn }}
{% endblock title %}

{% block content %}
<div class="row">
	<div class="col-sm-6">
		<h4>{{ object.entry.author }} <small> &mdash; {{ object.entry.title }}</small></h4>
	</div>
</div>

<div class="row">
	<div class="col-sm-5">
		<ul class="pager top pager-info">	
			{% if section_prev %}
			<li class="previous"><a href='../{{ section_prev.cts_urn }}/'>&laquo; {{ section_prev.section_ref }}</a></li>
			{% else %}
			<li class="previous disabled"><a href='#'>&laquo;</a></li>
			{% endif %}
			<li><a href="./">{{ object.section_ref }}</a></li>
			{% if section_next %}
			<li class="next"><a href='../{{ section_next.cts_urn }}/'>{{ section_next.section_ref }} &raquo;</a></li>
			{% else %}
			<li class="next disabled"><a href='#'>&raquo;</a></li>
			{% endif %}
		</ul>
	</div>
</div>

<div id="maincontent" class="row">

	<div id="text" class="col-sm-5 maintext">
		{% autoescape off %}  {{ section_text }} {% endautoescape %}
	</div>
	<div id="rightoftext" class="col-sm-1">
		{% if children %}
		Children
		<ul class="child-list small">
			{% for child in children %}
			<li class="child-item"><a href='../{{ child.cts_urn }}/'>{{ child.section_ref }}</a></li>
			{% endfor %}
		</ul>
		{% endif %}
	</div>

	<div id="commentary-outer-container" class="col-sm-6"> 
		<div class="row">
			<table id="commentary-table" class="table table-condensed table-responsive">
				<thead>
					<tr class="row small" id="commentary-table-header">
						<th class="col-sm-2 small text-primary">User</th>
						<th class="col-sm-9 small text-primary">Commentary</th>
						<th class="col-sm-1 small text-primary">+/-</th>
					</tr>
				</thead>
				<tbody id="commentary-container">
					<!-- this is where the action happens, requires javascript -->
				</tbody>
				<tfoot><tr class="row active" id="commentary-form-click-target" hidden="hidden"><td colspan="3" class="col-sm-12 small text-primary">Click here to add new commentary item</td></tr></tfoot>
			</table>
		</div>

		<span id="hidey-form" hidden="hidden">
			<div id="form-row"  class="row">
				<form action="/api/v1/sourcecommentary/" role="form" id="commentary-form">
					{% csrf_token %}
					<!-- div class="form-group" -->
					<div class="col-sm-12">
						<legend>New commentary</legend>
						<label for="f_commentary" class="sr-only">comment:</label>

						<textarea type="text" id="f_commentary" class="form-control input-sm"  name="commentary" rows="4"></textarea>

						<p>
							<input id="f_cts_urn" type="hidden" value="{{ object.cts_urn }}"/>
							<input id="f_section_input_id" type="hidden" name="section" value="/api/v1/sourcesection/{{ object.cts_urn }}/"/>
							<input id="f_user_input_id" type="hidden" name="user" value=""/>
						</p>

					</div>
				</form>
			</div>
			<div class="row">
				<div class="col-sm-9 small" id="md_instructions">
					Formatting guide: _<i>italics</i>_ ... **<b>bold</b>** ... press return/enter twice for paragraph. See <a href="http://daringfireball.net/projects/markdown/syntax" target="_new">Markdown syntax</a> for full guide.
				</div>
				<div class="col-sm-3">
					<input id="f_button_submit_id" type="button" value="save comment" class="btn btn-sm btn-primary pull-right"/>
				</div>
			</div>
		</span>
		
	</div>
</div>
<div class="row">
	<div class="col-sm-5">
		<ul class="pager bottom">	
			{% if section_prev %}
			<li class="previous"><a href='../{{ section_prev.cts_urn }}/'>&laquo; {{ section_prev.section_ref }}</a></li>
			{% else %}
			<li class="previous disabled"><a href='#'>&laquo;</a></li>
			{% endif %}
			<li class="text-info"><a href="./">{{ object.section_ref }}</a></li>
			{% if section_next %}
			<li class="next"><a href='../{{ section_next.cts_urn }}/'>{{ section_next.section_ref }} &raquo;</a></li>
			{% else %}
			<li class="next disabled"><a href='#'>&raquo;</a></li>
			{% endif %}
		</ul>
	</div>
</div>
{% endblock %}

{% block footer %}
<div id="nav2ancestors-footer" class="row">
	<div class="col-sm-6">
		<ol class="text-info breadcrumb">
			Location: 
			<li><a href='/text/{{ object.entry.cts_urn }}/'>{{ object.entry.cts_urn|prettyctsurn }}</a></li>
			{% for sect in section_path %}
			<li{% if forloop.last %} class='active'{% endif %}><a href='../{{ sect.cts_urn }}/'>{{ sect.section_ref }}</a></li>
			{% endfor %}
		</ol>
	</div>
	<div class="col-sm-6 ">
		<ol class="text-muted breadcrumb">
		<span class="pull-right">You are logged in as user '{{request.user.username}}'</span>
		</ol>
	</div>
</div>
<script src="/static/js/commentaries.js"></script>
<script>
// pre-set the user's details.
$('#commentary-outer-container').ready(function(){
	setuserdetail();
});

// when this container is ready fetch the commentaries
$('#commentary-table').ready(function(){
	commentaries('{{ object.cts_urn }}');
});
</script>

{% endblock footer %}
