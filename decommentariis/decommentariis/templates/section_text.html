{% extends 'commentarius_base.html' %}
{% load shorter_cts %}
{% block title %}
decommentariis - {{ object.entry.author }} -
{{ object.cts_urn }}
{% endblock title %}

{% block content %}
<div class="row">
	<div class="col-sm-4 col-sm-offset-1 small">
		<p>{{ object.entry.author }}<em>'{{ object.entry.title }}'</em></p>
	</div>
</div>
<div class="row">
	<div class="col-sm-6 small">
		<ul class="pager small top">	
			{% if section_prev %}
			<li class="previous"><a href='../{{ section_prev.cts_urn }}/'>&laquo; {{ section_prev.section_ref }}</a></li>
			{% else %}
			<li class="previous disabled"><a href='#'>&laquo;</a></li>
			{% endif %}
			<li class="selected"><a href="./">{{ object.section_ref }}</a></li>
			{% if section_next %}
			<li class="next"><a href='../{{ section_next.cts_urn }}/'>{{ section_next.section_ref }} &raquo;</a></li>
			{% else %}
			<li class="next disabled"><a href='#'>&raquo;</a></li>
			{% endif %}
		</ul>
	</div>
</div>

<div id="maincontent" class="row">
	<div id="leftoftext" class="col-sm-1">
		
	</div>
	<div id="text" class="col-sm-4 maintext">
		{% autoescape off %}  {{ section_text }} {% endautoescape %}
	</div>
	<div id="rightoftext" class="col-sm-1">
		{% if children %}
		Children
		<ul class="child-list small">
			{% for child in children %}
			<li class="child-item"><a href='../{{ child.cts_urn }}/'>{{ child.section_ref }}</a></li>
			{% endfor %}
		</ul>
		{% endif %}
	</div>
	<div id="commentary-outer-container" class="col-sm-6"> 
		<table id="commentary-table" class="table table-condensed table-responsive">
			<thead>
				<tr class="row small" id="commentary-table-header">
					<th class="col-sm-9 small text-muted">Commentary</th>
					<th class="col-sm-2 small text-muted">User</th>
					<th class="col-sm-1 small text-muted">+/-</th>
				</tr>
			</thead>
			<tbody id="commentary-container">
				<!-- this is where the action happens, requires javascript -->
			</tbody>
			<tfoot><tr class="row small active" id="commentary-form-click-target"><td colspan="3" class="col-sm-12 small text-muted">Add new commentary item</td></tr></tfoot>
		</table>
		<div id="hidey-form" class="small row">
			<form action="/api/v1/sourcecommentary/" role="form" id="commentary-form">
				{% csrf_token %}
				<div class="form-group">
					<input id="f_cts_urn" type="hidden" value="{{ object.cts_urn }}"/>
					<input id="f_section_input_id" type="hidden" name="section" value="/api/v1/sourcesection/{{ object.cts_urn }}/"/>
					<input id="f_user_input_id" type="hidden" name="user" value=""/>
					<div class="col-sm-10">
						<label for="f_commentary" class="sr-only">comment:</label>
						<textarea type="text" id="f_commentary" class="form-control input-sm"  name="commentary" rows="2"></textarea>
					</div>
					<div class="col-sm-2">
						<input id="f_button_submit_id" type="button" value="comment" class="btn btn-sm pull-right"/>
					</div>
				</div>
			</form>
		</div>
	</div>
</div>
<div class="row">
	<div class="col-sm-6 small">
		<ul class="pager small bottom">	
			{% if section_prev %}
			<li class="previous"><a href='../{{ section_prev.cts_urn }}/'>&laquo; {{ section_prev.section_ref }}</a></li>
			{% else %}
			<li class="previous disabled"><a href='#'>&laquo;</a></li>
			{% endif %}
			<li class="selected"><a href="./">{{ object.section_ref }}</a></li>
			{% if section_next %}
			<li class="next"><a href='../{{ section_next.cts_urn }}/'>{{ section_next.section_ref }} &raquo;</a></li>
			{% else %}
			<li class="next disabled"><a href='#'>&raquo;</a></li>
			{% endif %}
		</ul>
	</div>
</div>
{% endblock %}

{% block footer %}
</script>
<div id="nav2ancestors-footer" class="row">
	<div class="col-sm-6">
		<p class="text-muted">
			text loc <a href='/text/{{ object.entry.cts_urn }}/'>{{ object.entry.cts_urn|prettyctsurn }}</a>
			{% for sect in section_path %}
			:: <a href='../{{ sect.cts_urn }}/'>{{ sect.section_ref }}</a>
			{% endfor %}
		</p>
	</div>
	<div class="col-sm-6">
		<p class="text-muted">You are logged in as user '{{request.user.username}}'</p>
	</div>
</div>
<script src="/static/js/commentaries.js"></script>
<script>
// pre-set the user's details.
$('#commentary-outer-container').ready(function(){
	userdetail('{{ request.user.username }}')
});

// when this container is ready fetch the commentaries
$('#commentary-table').ready(function(){
	commentaries('{{ object.cts_urn }}');
});
</script>

{% endblock footer %}
