{% extends 'commentarius_base.html' %}

{% block title %}
decommentariis - {{ object.entry.author }} -
{{ object.cts_urn }}
{% endblock title %}

{% block content %}
<div class="row">
	<div class="col-sm-4 col-sm-offset-1 small">
		<p>{{ object.entry.author }}<em>'{{ object.entry.title }}'</em></p>
	</div>
</div>
<div class="row">
	<div class="col-sm-6 small">
		<ul class="pager small top">	
			{% if section_prev %}
			<li class="previous"><a href='../{{ section_prev.cts_urn }}/'>&laquo; {{ section_prev.section_ref }}</a></li>
			{% else %}
			<li class="previous disabled"><a href='#'>&laquo;</a></li>
			{% endif %}
			<li class="selected"><a href="./">{{ object.section_ref }}</a></li>
			{% if section_next %}
			<li class="next"><a href='../{{ section_next.cts_urn }}/'>{{ section_next.section_ref }} &raquo;</a></li>
			{% else %}
			<li class="next disabled"><a href='#'>&raquo;</a></li>
			{% endif %}
		</ul>
	</div>
</div>

<div id="maincontent" class="row">
	<div id="leftoftext" class="col-sm-1">
		
	</div>
	<div id="text" class="col-sm-4 maintext">
		{% autoescape off %}  {{ section_text }} {% endautoescape %}
	</div>
	<div id="rightoftext" class="col-sm-1">
		{% if children %}
		Children
		<ul class="child-list small">
			{% for child in children %}
			<li class="child-item"><a href='../{{ child.cts_urn }}/'>{{ child.section_ref }}</a></li>
			{% endfor %}
		</ul>
		{% endif %}
	</div>
	<div id="commentary-outer-container" class="col-sm-6"> 
		<div id="hidey-form" class="small row">
			<form action="/api/v1/sourcecommentary/" role="form" id="commentary-form">
				{% csrf_token %}
				<div class="form-group">
					<input id="f_cts_urn" type="hidden" value="{{ object.cts_urn }}"/>
					<input id="f_section_input_id" type="hidden" name="section" value="/api/v1/sourcesection/{{ object.cts_urn }}/"/>
					<input id="f_user_input_id" type="hidden" name="user" value=""/>
					<div class="col-sm-10">
						<label for="f_commentary" class="sr-only">comment:</label>
						<textarea type="text" id="f_commentary" class="form-control input-sm"  name="commentary" rows="2"></textarea>
					</div>
					<div class="col-sm-2">
						<input id="f_button_submit_id" type="button" value="comment" class="btn btn-sm pull-right"/>
					</div>
				</div>
			</form>
		</div>
		<table id="commentary-container" class="table table-striped table-hover table-condensed table-responsive">
			<tbody>
				<tr class="row small" id="commentary-table-header">
					<th class="col-sm-9 small text-muted">User commentary items</th>
					<th class="col-sm-2 small text-muted">User</th>
					<th class="col-sm-1 small text-muted">Votes</th>
				</tr>
				<!-- this is where the action happens, requires javascript -->
			</tbody>
		</table>
	</div>
</div>
<div class="row">
	<div class="col-sm-6 small">
		<ul class="pager small bottom">	
			{% if section_prev %}
			<li class="previous"><a href='../{{ section_prev.cts_urn }}/'>&laquo; {{ section_prev.section_ref }}</a></li>
			{% else %}
			<li class="previous disabled"><a href='#'>&laquo;</a></li>
			{% endif %}
			<li class="selected"><a href="./">{{ object.section_ref }}</a></li>
			{% if section_next %}
			<li class="next"><a href='../{{ section_next.cts_urn }}/'>{{ section_next.section_ref }} &raquo;</a></li>
			{% else %}
			<li class="next disabled"><a href='#'>&raquo;</a></li>
			{% endif %}
		</ul>
	</div>
</div>
{% endblock %}

{% block footer %}
</script>
<div id="nav2ancestors-footer" class="row">
	<div class="col-sm-6">
		<p class="text-muted">
			text loc <a href='/text/{{ object.entry.cts_urn }}/'>{{ object.entry.cts_urn }}</a>
			{% for sect in section_path %}
			:: <a href='../{{ sect.cts_urn }}/'>{{ sect.section_ref }}</a>
			{% endfor %}
		</p>
	</div>
	<div class="col-sm-6">
		<p class="text-muted">You are logged in as user '{{request.user.username}}'</p>
	</div>
</div>
<script src="/static/js/commentaries.js">
</script>
<script>
	$('#commentary-container').ready(function(){
		commentaries('{{ object.cts_urn }}');
	});
	$('commentary-outer-container').ready(function(){
		userdetail('{{ request.user.username }}')
	});
	// wait for the button to be loaded, then plonk this function on it's click. 
	$('#f_button_submit_id').ready(function() { 
		$('#f_button_submit_id').css("background-color", "#ccc");
		$(function() {
			var fn=function(){
				$('#f_button_submit_id').css("background-color", "#fcc");
				make_comment($('#commentary-form'))
			};
			$('#f_button_submit_id').click(fn);
		});
	}); 
	// table container
	$('#commentary-table-header').ready(function() {
		$(function() {
			var fn=function() {
				$('#hidey-form').slideToggle(400);
			}
			$('#commentary-table-header').click(fn);
		});
	});
</script>
{% endblock footer %}
